{"version":3,"sources":["assets\\code\\gameManager.js"],"names":["cc","Class","Component","properties","distanceText","Node","distance","player","following","endPosition","gameEnded","winnerCanva","finishedPlayers","playerPrefab","Prefab","timesUpUi","spawn","camera","players","spectateIndex","spectateUI","emojiButton","emojiUI","mobileController","numFinished","crownsNode","onLoad","director","getCollisionManager","enabled","game","setFrameRate","addWinner","place","getComponent","Label","string","children","length","aPlayer","instantiate","parent","getChildByName","name","find","myTime","timesUp","disable","active","showCrowns","crowns","console","log","showWinners","closeCrowns","closeSpectate","goBackToLobby","disconnect","loadScene","confirmTimesUp","openSpectateUi","showEmojis","sepctatePrev","newPlayer","spectateNext","update","dt","myPlayer","playerId"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        distanceText: cc.Node,\r\n        distance: 0,\r\n        player: cc.Node,\r\n        following: false,\r\n        endPosition: cc.Node,\r\n        gameEnded: false,\r\n        winnerCanva: cc.Node,\r\n        finishedPlayers: cc.Node,\r\n        playerPrefab: cc.Prefab,\r\n        timesUpUi: cc.Node,\r\n        spawn: cc.Node,\r\n        camera: cc.Node,\r\n        players: cc.Node,\r\n        spectateIndex: 0,\r\n        spectateUI: cc.Node,\r\n        emojiButton: cc.Node,\r\n        emojiUI: cc.Node,\r\n        mobileController: cc.Node,\r\n        numFinished: cc.Node,\r\n        crownsNode: cc.Node,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad() {\r\n        cc.director.getCollisionManager().enabled = true;\r\n        cc.game.setFrameRate(60);\r\n        //cc.director.getCollisionManager().enabledDebugDraw = true; \r\n        //cc.director.getCollisionManager().enabledDrawBoundingBox = true;\r\n        \r\n    },\r\n\r\n    addWinner(player, place) {\r\n        this.numFinished.getComponent(cc.Label).string = place + \"/\" + this.players.children.length + \" finished\";\r\n        let aPlayer = cc.instantiate(this.playerPrefab);\r\n        aPlayer.parent = this.finishedPlayers;\r\n        aPlayer.getChildByName(\"TEXT\").getComponent(cc.Label).string = player.name + \" finished in \" + place + \" place   \" + cc.find(\"system\").getComponent(\"client\").myTime + \"s\";\r\n    },\r\n    timesUp() {\r\n        this.player.getComponent(\"movement\").disable();\r\n        this.gameEnded = true;\r\n        this.timesUpUi.active = true;\r\n    },\r\n    showCrowns(crowns) {\r\n        this.crownsNode.active = true;\r\n        console.log(crowns);\r\n        if (crowns > 0)\r\n            this.crownsNode.getChildByName(\"CROWNS\").getComponent(cc.Label).string = \"+ \" + crowns;\r\n        else\r\n            this.crownsNode.getChildByName(\"CROWNS\").getComponent(cc.Label).string = crowns;\r\n    },\r\n    showWinners(crowns) {\r\n        this.winnerCanva.active = true;\r\n    },\r\n    closeCrowns() {\r\n        this.crownsNode.active = false;\r\n    },\r\n    closeSpectate() {\r\n        this.winnerCanva.active = true;\r\n        this.spectateUI.active = false;\r\n    },\r\n    goBackToLobby() {\r\n        // go back to lobby\r\n        cc.find(\"system\").getComponent(\"client\").disconnect();\r\n        cc.director.loadScene(\"home\");\r\n    },\r\n    confirmTimesUp() {\r\n        this.timesUpUi.active = false;\r\n        this.showWinners();\r\n    },\r\n    openSpectateUi() {\r\n        this.winnerCanva.active = false;\r\n        this.spectateUI.active = true;\r\n    },\r\n    showEmojis() {\r\n        this.emojiButton.active = !this.emojiButton.active;\r\n        this.emojiUI.active = !this.emojiUI.active;\r\n    },\r\n    sepctatePrev() {\r\n        this.spectateIndex -=1;\r\n        if (this.spectateIndex < 0)\r\n            this.spectateIndex = this.players.children.length-1;\r\n\r\n        let newPlayer = this.players.children[this.spectateIndex];\r\n        this.camera.getComponent(\"cameraFollow\").player = newPlayer;\r\n        // change spectating player name\r\n        this.spectateUI.getChildByName(\"NAME\").getComponent(cc.Label).string = \"Spectating \" + newPlayer.getChildByName(\"nameTag\").getComponent(cc.Label).string;\r\n    },\r\n    spectateNext() {\r\n        // spectate next player\r\n        this.spectateIndex += 1;\r\n        if (this.spectateIndex >= this.players.children.length)\r\n            this.spectateIndex = 0;\r\n        let newPlayer = this.players.children[this.spectateIndex];\r\n        this.camera.getComponent(\"cameraFollow\").player = newPlayer;\r\n        // change spectating player name\r\n        this.spectateUI.getChildByName(\"NAME\").getComponent(cc.Label).string = \"Spectating \" + newPlayer.getChildByName(\"nameTag\").getComponent(cc.Label).string;\r\n    },\r\n    update(dt) {\r\n        \r\n        if (!this.following) {\r\n            if (cc.find(\"system\").getComponent(\"client\").myPlayer != null) {\r\n                this.player = cc.find(\"Canvas/Players/\" + cc.find(\"system\").getComponent(\"client\").playerId);\r\n                this.following = true;\r\n                this.numFinished.getComponent(cc.Label).string = \"0/\" + this.players.children.length + \" finished\";\r\n            }\r\n        } else {\r\n            //this.distance = Math.floor(Math.sqrt(Math.pow((this.endPosition.x - this.player.x), 2) + Math.pow((this.endPosition.y - this.player.y), 2)) / 10);\r\n            //this.distanceText.getComponent(cc.Label).string = this.distance + \" m\";\r\n            if (this.gameEnded) {\r\n                this.player.getComponent(\"movement\").active = false;\r\n                this.mobileController.active = false;\r\n            }\r\n        }\r\n\r\n    },\r\n});\r\n"]}