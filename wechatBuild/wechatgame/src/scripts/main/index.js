window.__require=function e(t,n,i){function o(c,a){if(!n[c]){if(!t[c]){var r=c.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+c+"'")}c=r}var l=n[c]={exports:{}};t[c][0].call(l.exports,function(e){return o(t[c][1][e]||e)},l,l.exports,e,t,n,i)}return n[c].exports}for(var s="function"==typeof __require&&__require,c=0;c<i.length;c++)o(i[c]);return o}({aboutPlayer:[function(e,t){"use strict";cc._RF.push(t,"24e50iIUj1Pe5bYvGHChgiW","aboutPlayer"),cc.Class({extends:cc.Component,properties:{playerId:null,room:null,crowns:0,openid:null,serverIp:null},onLoad:function(){cc.game.addPersistRootNode(this.node)}}),cc._RF.pop()},{}],cameraFollow:[function(e,t){"use strict";cc._RF.push(t,"7455eGZiFJOY4D93jmfSLWz","cameraFollow"),cc.Class({extends:cc.Component,properties:{player:null,following:!1,background:cc.Node,ui:cc.Node,yOffset:0,paralaxLayers:[cc.Node],startPos:[],xOffsetPlayer:0,yOffsetPlayer:0},onLoad:function(){this.startPos=[0,0,0,0,0,0,0]},start:function(){},update:function(){this.following?(this.node.x=this.player.x+this.xOffsetPlayer,this.node.y=this.player.y+this.yOffset+this.yOffsetPlayer):null!=cc.find("system").getComponent("client").myPlayer&&(this.player=cc.find("Canvas/Players/"+cc.find("system").getComponent("client").playerId),this.following=!0);for(var e=0;e<this.paralaxLayers.length;e++)this.paralaxLayers[e].setPosition(this.node.x/(e+1)*2+this.startPos[e],this.node.y/(e+1)*2),Math.abs(this.node.x-this.paralaxLayers[e].x)>=this.paralaxLayers[e].width-this.node.width&&(this.startPos[e]+=this.node.x-this.paralaxLayers[e].x);this.background.setPosition(this.node.x,this.node.y),this.ui.x=this.node.x,this.ui.y=this.node.y}}),cc._RF.pop()},{}],client:[function(e,t){"use strict";cc._RF.push(t,"a81a2Ib2/pKLaqHfaR6js1d","client");var n=function(e,t){this.type=e,this.data=t};function i(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}cc.Class({extends:cc.Component,properties:{playerId:0,ws:null,players:null,playerPrefab:{default:null,type:cc.Prefab},myPlayer:null,port:null,startPlace:cc.Node,timer:cc.Node,watch:cc.Node,myTime:0,enemies:cc.Node,won:!1,countDown:null,items:cc.Node,shortOnTime:!1,watchAnim:cc.Animation,connectionErrorUI:cc.Node,socketClosed:!1,potionPrefab:cc.Prefab,cakePrefab:cc.Prefab,gameStarted:!1,startScreen:cc.Node,crowns:0,chestPrefab:cc.Prefab,serverIp:"",pointsLost:0},sendWebsocketMessage:function(e,t){this.connectionErrorUI.active||(cc.sys.platform==cc.sys.WECHAT_GAME?this.ws.send({data:JSON.stringify(new n(e,t))}):this.ws.send(JSON.stringify(new n(e,t))))},sendPlayerState:function(e){this.sendWebsocketMessage("updatePlayerState",[this.playerId,e])},sendEnemyState:function(e,t,n){this.sendWebsocketMessage("updateEnemy",[this.playerId,t,e,n])},sendItemState:function(e,t,n,i){"chest"==n&&"spawn"==t?this.scheduleOnce(function(){this.sendWebsocketMessage("updateItem",[e,t,n,i])},3):this.sendWebsocketMessage("updateItem",[e,t,n,i])},sendEmoji:function(e,t){this.sendWebsocketMessage("emoji",[this.playerId,t]),this.node.getComponent("gameManager").hideEmojis()},createPlayer:function(e){if(e.id==this.playerId)this.myPlayer=cc.instantiate(this.playerPrefab),this.myPlayer.parent=cc.find("Canvas/Players"),this.myPlayer.x=this.startPlace.x,this.myPlayer.y=this.startPlace.y,this.myPlayer.name=e.id,this.myPlayer.getChildByName("nameTag").getComponent(cc.Label).string=e.name,this.myPlayer.id=e.id,this.players[e.id]=this.myPlayer;else{var t=cc.instantiate(this.playerPrefab);t.parent=cc.find("Canvas/Players"),t.x=this.startPlace.x,t.y=this.startPlace.y,t.name=e.id,t.id=e.id,t.getChildByName("nameTag").getComponent(cc.Label).string=e.name,t.getChildByName("nameTag").color=cc.Color.WHITE,this.players[e.id]=t}},updatePlayer:function(e,t){var n=this.players[e];switch(t){case"right":n.getComponent("movement").moveRight();break;case"left":n.getComponent("movement").moveLeft();break;case"jump":n.getComponent("movement").jump();break;case"stopX":n.getComponent("movement").stopX();break;case"stopY":n.getComponent("movement").stopY()}},updateEnemy:function(e,t,n,i){var o=this.players[e];switch(n){case"chaseNew":this.enemies.getChildByName(i).getComponent("enemyScript").chasePlayer(o);break;case"right":this.enemies.getChildByName(i).getComponent("enemyScript").moveRight();break;case"left":this.enemies.getChildByName(i).getComponent("enemyScript").moveLeft();break;case"jump":this.enemies.getChildByName(i).getComponent("enemyScript").jump();break;case"position":this.enemies.getChildByName(i).x=t[0],this.enemies.getChildByName(i).y=t[1]}},updatePlayerPosition:function(e){this.players[e.id].x=e.posX,this.players[e.id].y=e.posY,this.players[e.id].setScale(e.scaleX,e.scaleY)},removePlayer:function(e){this.players[e.id].destroy(),this.players.delete(e.id)},updateTime:function(e){this.countDown-e>=0?(this.timer.getComponent(cc.Label).string=e,this.watch.angle=-(360*e/this.countDown-90),this.myTime=e,!this.shortOnTime&&this.countDown-e<15&&(this.watchAnim=this.watch.getParent().getComponent(cc.Animation).play("shortOnTime"),this.watchAnim.wrapMode=cc.WrapMode.Loop,this.shortOnTime=!0)):this.shortOnTime&&(this.watchAnim.stop("shortOnTime"),this.watch.getParent().color=cc.Color.RED,cc.find("system").getComponent("gameManager").timesUp(),this.shortOnTime=!1,this.won||(cc.find("system").getChildByName("AUDIO").getChildByName("LOSE").getComponent(cc.AudioSource).play(),console.log(this.crowns),this.crowns>30?this.node.getComponent("gameManager").showCrowns(this.pointsLost):this.node.getComponent("gameManager").showCrowns(0)))},disconnect:function(){this.socketClosed=!0,cc.sys.os==cc.sys.WECHAT_GAME?this.ws.closeSocket():this.ws.close()},updateItem:function(e,t,n,i){if("used"==t)this.items.getChildByName(n+e).destroy();else if("spawn"==t){var o=null;"potion"==n?o=cc.instantiate(this.potionPrefab):"cake"==n?o=cc.instantiate(this.cakePrefab):"chest"==n&&(o=cc.instantiate(this.chestPrefab)),o.x=i[0],o.y=i[1],o.parent=this.items,o.name=n+e,o.getComponent("item").id=e}},updateEmoji:function(e,t){this.players[e].getComponent("movement").playEmoji(t)},startCountDown:function(e){this.startScreen.active=!0,0==e?(this.startScreen.active=!1,this.gameStarted=!0):this.startScreen.getChildByName("NUM").getComponent(cc.Label).string=e},recieveMessage:function(e){var t=JSON.parse(e);switch(t.type){case"updatePlayerState":t.data[0]!=this.playerId&&this.updatePlayer(t.data[0],t.data[1]);break;case"remove":this.removePlayer(t.data);break;case"initRoom":for(var n in this.countDown=t.data[1],this.pointsLost=t.data[2],console.log(this.countDown),t.data[0])this.createPlayer(t.data[0][n]);break;case"positions":for(var n in t.data)this.playerId!=t.data[n].id&&this.updatePlayerPosition(t.data[n]);break;case"finish":this.playerId==t.data[0].id&&(this.node.getComponent("gameManager").showWinners(),this.node.getComponent("gameManager").showCrowns(t.data[2])),this.node.getComponent("gameManager").addWinner(t.data[0],t.data[1]);break;case"time":this.updateTime(t.data);break;case"updateEnemy":t.data[0]!=this.playerId&&this.updateEnemy(t.data[0],t.data[1],t.data[2],t.data[3]);break;case"updateItem":this.updateItem(t.data[0],t.data[1],t.data[2],t.data[3]);break;case"emoji":this.updateEmoji(t.data[0],t.data[1]);break;case"start":this.startCountDown(t.data)}},joinServer:function(){var e=this;cc.sys.platform==cc.sys.WECHAT_GAME?(this.ws=wx.connectSocket({url:"ws://"+this.serverIp+":"+this.port}),this.ws.onOpen(function(){console.log("we are connected"),e.sendWebsocketMessage("playerInfo",e.playerId)}),this.ws.onMessage(function(t){var n=t.data;e.recieveMessage(n)}),this.ws.onError(function(){console.log("error"),e.connectionErrorUI.active=!0,cc.find("Canvas/UI/MOBILE").active=!1}),this.ws.onClose(function(){e.socketClosed||(e.connectionErrorUI.active=!0,cc.find("Canvas/UI/MOBILE").active=!1)})):(this.ws=new WebSocket("ws://"+this.serverIp+":"+this.port),this.ws.addEventListener("open",function(){console.log("we are connected"),e.sendWebsocketMessage("playerInfo",e.playerId)}),this.ws.addEventListener("error",function(){console.log("error"),e.connectionErrorUI.active=!0,cc.find("Canvas/UI/MOBILE").active=!1}),this.ws.addEventListener("close",function(){e.socketClosed||(e.connectionErrorUI.active=!0,cc.find("Canvas/UI/MOBILE").active=!1)}),this.ws.addEventListener("message",function(t){var n=t.data;e.recieveMessage(n)}))},onLoad:function(){this.pointsLost=5,this.playerId=cc.find("MANAGER").getComponent("aboutPlayer").playerId,this.port=cc.find("MANAGER").getComponent("aboutPlayer").room,this.serverIp=cc.find("MANAGER").getComponent("aboutPlayer").serverIp,this.crowns=cc.find("MANAGER").getComponent("aboutPlayer").crowns,this.players=new Map,this.joinServer()},start:function(){},update:function(){null!=this.myPlayer&&this.sendWebsocketMessage("position",[this.myPlayer.x,this.myPlayer.y,i(this.myPlayer.scaleY,5),i(this.myPlayer.scaleX,5)])}}),cc._RF.pop()},{}],enableGravity:[function(e,t){"use strict";cc._RF.push(t,"aa7d1iW6uVJopxU89YUUYHx","enableGravity"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.director.getPhysicsManager().enabled=!0},start:function(){}}),cc._RF.pop()},{}],enemyScript:[function(e,t){"use strict";cc._RF.push(t,"64fd02CYvtGPYd3Jt9F1sLL","enemyScript"),cc.Class({extends:cc.Component,properties:{chasingPlayer:cc.Node,speed:100,player:cc.Node,walkSpeed:50,jumpHeight:100,checking:!1,deltaTime:0,grounded:!1,alertNode:cc.Node,patrolling:!1,animation:cc.Animation,canAttack:!0,attackCooldown:2,attackRange:5,canMove:!0,moving:!1,playingIdle:!0},chasePlayer:function(e){this.chasingPlayer=e,e==this.player?(this.alertNode.active=!0,cc.find("system").getComponent("client").sendEnemyState("chaseNew",[null,null],this.node.name)):this.alertNode.active=!1},jump:function(){this.chasingPlayer==this.player&&(cc.find("system").getComponent("client").sendEnemyState("jump",[null,null],this.node.name),this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.getComponent(cc.RigidBody).linearVelocity.x,this.jumpHeight))},attack:function(){this.canAttack=!1,this.animation.play("cardGuyAttack"),this.scheduleOnce(function(){this.canAttack=!0},this.attackCooldown)},moveRight:function(){this.moving||(this.animation.play("cardGuyWalk").wrapMode=cc.WrapMode.Loop,this.moving=!0,this.playingIdle=!1),this.node.scaleX=-Math.abs(this.node.scaleX),this.chasingPlayer==this.player&&(cc.find("system").getComponent("client").sendEnemyState("right",[null,null],this.node.name),this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.speed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y))},moveLeft:function(){this.moving||(this.animation.play("cardGuyWalk").wrapMode=cc.WrapMode.Loop,this.moving=!0,this.playingIdle=!1),this.node.scaleX=Math.abs(this.node.scaleX),this.chasingPlayer==this.player&&(cc.find("system").getComponent("client").sendEnemyState("left",[null,null],this.node.name),this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.speed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y))},onCollisionEnter:function(e){"playerHitbox"==e.node.group&&e.node.getParent().getParent()==this.player&&(null!=this.chasingPlayer?this.checking=!0:this.chasePlayer(this.player))},onCollisionExit:function(e){e.node.getParent().getParent()==this.chasingPlayer&&(this.chasingPlayer=null,this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(0,0),this.alertNode.active=!1),e.node.getParent().getParent()==this.player&&(this.checking=!1)},onBeginContact:function(e,t){2==t.tag&&(this.grounded=!0)},start:function(){},update:function(e){if(this.deltaTime=e,this.canMove){if(0!=this.getComponent(cc.RigidBody).linearVelocity.x||this.playingIdle||(this.animation.stop("cardGuyWalk"),this.animation.play("idle"),this.moving=!1,this.playingIdle=!0),null==this.player)0==cc.find("system").getComponent("client").playerId||(this.player=cc.find("Canvas/Players/"+cc.find("system").getComponent("client").playerId));else if(this.chasingPlayer==this.player)cc.find("system").getComponent("client").sendEnemyState("position",[this.node.x,this.node.y],this.node.name),(this.player.x-this.node.x)/Math.abs(this.player.x-this.node.x)>0?this.moveRight():this.moveLeft(),Math.sqrt(Math.pow(this.player.x-this.node.x,2)+Math.pow(this.player.y-this.node.y,2))<this.attackRange&&this.canAttack&&this.attack();else if(this.checking&&null!=this.chasingPlayer){var t=Math.abs(this.node.x-this.player.x),n=Math.abs(this.node.x-this.chasingPlayer.x);this.player!=this.chasingPlayer&&t<n&&this.chasePlayer(this.player)}}else this.canAttack&&this.attack()}}),cc._RF.pop()},{}],gameManager:[function(e,t){"use strict";cc._RF.push(t,"f88aaqmmHtO/qKttC/WpRhf","gameManager"),cc.Class({extends:cc.Component,properties:{distanceText:cc.Node,distance:0,player:cc.Node,following:!1,endPosition:cc.Node,gameEnded:!1,winnerCanva:cc.Node,finishedPlayers:cc.Node,playerPrefab:cc.Prefab,timesUpUi:cc.Node,spawn:cc.Node,camera:cc.Node,players:cc.Node,spectateIndex:0,spectateUI:cc.Node,emojiButton:cc.Node,emojiUI:cc.Node,mobileController:cc.Node,numFinished:cc.Node,crownsNode:cc.Node},onLoad:function(){cc.director.getCollisionManager().enabled=!0,cc.game.setFrameRate(60)},addWinner:function(e,t){this.numFinished.getComponent(cc.Label).string=t+"/"+this.players.children.length+" finished";var n=cc.instantiate(this.playerPrefab);n.parent=this.finishedPlayers,n.getChildByName("TEXT").getComponent(cc.Label).string=e.name+" finished in "+t+" place   "+cc.find("system").getComponent("client").myTime+"s"},timesUp:function(){this.player.getComponent("movement").disable(),this.gameEnded=!0,this.timesUpUi.active=!0},showCrowns:function(e){this.crownsNode.active=!0,console.log(e),this.crownsNode.getChildByName("CROWNS").getComponent(cc.Label).string=e>0?"+ "+e:e},showWinners:function(){this.winnerCanva.active=!0},closeCrowns:function(){this.crownsNode.active=!1},closeSpectate:function(){this.winnerCanva.active=!0,this.spectateUI.active=!1},goBackToLobby:function(){cc.find("system").getComponent("client").disconnect(),cc.director.loadScene("home")},confirmTimesUp:function(){this.timesUpUi.active=!1,this.showWinners()},openSpectateUi:function(){this.winnerCanva.active=!1,this.spectateUI.active=!0},showEmojis:function(){this.emojiButton.active=!1,this.emojiUI.active=!0},hideEmojis:function(){this.emojiButton.active=!0,this.emojiUI.active=!1},sepctatePrev:function(){this.spectateIndex-=1,this.spectateIndex<0&&(this.spectateIndex=this.players.children.length-1);var e=this.players.children[this.spectateIndex];this.camera.getComponent("cameraFollow").player=e,this.spectateUI.getChildByName("NAME").getComponent(cc.Label).string="Spectating "+e.getChildByName("nameTag").getComponent(cc.Label).string},spectateNext:function(){this.spectateIndex+=1,this.spectateIndex>=this.players.children.length&&(this.spectateIndex=0);var e=this.players.children[this.spectateIndex];this.camera.getComponent("cameraFollow").player=e,this.spectateUI.getChildByName("NAME").getComponent(cc.Label).string="Spectating "+e.getChildByName("nameTag").getComponent(cc.Label).string},update:function(){this.following?this.gameEnded&&(this.player.getComponent("movement").active=!1,this.mobileController.active=!1):null!=cc.find("system").getComponent("client").myPlayer&&(this.player=cc.find("Canvas/Players/"+cc.find("system").getComponent("client").playerId),this.following=!0,this.numFinished.getComponent(cc.Label).string="0/"+this.players.children.length+" finished")}}),cc._RF.pop()},{}],groundChecker:[function(e,t){"use strict";cc._RF.push(t,"18acbEoJ0lKjq90TLbihN4J","groundChecker"),cc.Class({extends:cc.Component,properties:{canJumpOn:[cc.String],canJump:!1},onCollisionEnter:function(e){for(var t in this.canJumpOn)e.node.group==this.canJumpOn[t]&&(this.canJump=!0)},onCollisionExit:function(){this.canJump=!1},start:function(){}}),cc._RF.pop()},{}],hitChecker:[function(e,t){"use strict";cc._RF.push(t,"48ba3aDNJ5IHoFZBg7Sk2wk","hitChecker"),cc.Class({extends:cc.Component,properties:{player:cc.Node},die:function(){this.player.getComponent("movement").isPlayer&&(this.player.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(0,0),this.player.x=cc.find("system").getComponent("gameManager").spawn.x,this.player.y=cc.find("system").getComponent("gameManager").spawn.y,this.player.getComponent("movement").growing=1,cc.sys.platform==cc.sys.WECHAT_GAME&&wx.vibrateShort("medium"))},win:function(){this.player.getComponent("movement").isPlayer&&!cc.find("system").getComponent("client").won&&(cc.find("Canvas/UI/MOBILE").active=!1,cc.find("system").getComponent("client").won=!0,cc.find("system").getComponent("client").sendPlayerState("win"),this.player.getComponent("movement").disable(),this.enabled=!1,cc.find("system").getChildByName("AUDIO").getChildByName("WIN").getComponent(cc.AudioSource).play())},eatCake:function(e){this.player.getComponent("movement").isPlayer&&(this.player.getComponent("movement").ateCake=!0,cc.find("system").getComponent("client").sendItemState(e.getComponent("item").id,"used","cake",null),cc.find("Canvas/UI/MOBILE/CAKE").active=!0)},drinkPotion:function(e){this.player.getComponent("movement").isPlayer&&(this.player.getComponent("movement").atePotion=!0,cc.find("system").getComponent("client").sendItemState(e.getComponent("item").id,"used","potion",null),cc.find("Canvas/UI/MOBILE/POTION").active=!0)},openChest:function(e){e.getComponent("item").openChest(this.player.getComponent("movement").isPlayer)},setCheckPoint:function(e){this.player.getComponent("movement").isPlayer&&cc.find("system").getComponent("gameManager").spawn!=e&&(cc.find("system").getComponent("gameManager").spawn=e,e.getChildByName("body").getChildByName("FACE").active=!1,e.getChildByName("body").getChildByName("FACE2").active=!0,e.getComponent(cc.Animation).play("textPopup"),e.getComponent(cc.AudioSource).play())},onCollisionEnter:function(e){"dangerous"==e.node.group?this.die():"end"==e.node.group?this.win():"checkpoint"==e.node.group?this.setCheckPoint(e.node):"item"==e.node.group&&("cake"==e.node.getComponent("item").type?this.eatCake(e.node):"potion"==e.node.getComponent("item").type?this.drinkPotion(e.node):"chest"==e.node.getComponent("item").type&&this.openChest(e.node))},onLoad:function(){null==this.player&&(this.player=this.node.getParent())},update:function(){}}),cc._RF.pop()},{}],item:[function(e,t){"use strict";cc._RF.push(t,"3d8d6+uMDhDV4YuecH/+Czd","item"),cc.Class({extends:cc.Component,properties:{id:"",type:"",spawned:!1,potionPrefab:cc.Prefab,cakePrefab:cc.Prefab,cakeProb:30,potoinProb:30,opened:!1},animateFloating:function(){var e=cc.tween().by(1,{y:20},{easing:"sineOut"}),t=cc.tween().by(1,{y:-20},{easing:"sineIn"}),n=cc.tween().sequence(e,t);return cc.tween().repeatForever(n)},openChest:function(e){if(!this.opened&&(this.opened=!0,e)){this.node.getComponent(cc.AudioSource).play();var t=Math.floor(100*Math.random()),n="";t<=this.cakeProb?n="cake":t<=this.cakeProb+this.potoinProb&&(n="potion"),this.spawned=!0,""!=n&&cc.find("system").getComponent("client").sendItemState(this.id,"spawn",n,[this.node.x+50,this.node.y+50]),cc.find("system").getComponent("client").sendItemState(this.id,"spawn","chest",[this.node.x,this.node.y]),cc.find("system").getComponent("client").sendItemState(this.id,"used","chest",null)}},makeid:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},onLoad:function(){null==this.id&&(this.id=this.makeid()),this.node.name=this.type+this.id,"chest"!=this.type&&cc.tween(this.node).then(this.animateFloating()).start()},start:function(){}}),cc._RF.pop()},{}],lobby:[function(e,t){"use strict";cc._RF.push(t,"f0b8dGoFs9D0Y2a3uyBs+rE","lobby");var n=function(e,t){this.type=e,this.data=t};cc.Class({extends:cc.Component,properties:{ws:null,playerNameNode:cc.Node,playerName:null,joining:!1,buttonText:cc.Node,lobbyInfoText:cc.Node,lobbyStatusText:cc.Node,playerId:null,connected:!1,status:"(waiting for players...)",errorNode:cc.Node,connecting:!1,tutorials:[cc.Node],tutorialIndex:0,tutorialPage:cc.Node,usernameNode:cc.Node,serverIp:"",haveUserData:!1,showingLeaderboard:!0,leaderboardNode:cc.Node,leaderboardTitle:cc.Node,playerStatPrefab:cc.Prefab,playerRecordPrefab:cc.Prefab,recordsNode:cc.Node,recordsTitle:cc.Node,crowns:0},showNext:function(){this.showingLeaderboard?(this.leaderboardNode.active=!1,this.leaderboardTitle.active=!1,this.recordsTitle.active=!0,this.recordsNode.active=!0,this.showingLeaderboard=!1):(this.leaderboardNode.active=!0,this.leaderboardTitle.active=!0,this.recordsTitle.active=!1,this.recordsNode.active=!1,this.showingLeaderboard=!0)},joinLobbySuccessfully:function(){console.log("joined lobby"),this.connected=!0,cc.sys.platform!=cc.sys.WECHAT_GAME&&(this.playerId=this.playerNameNode.getComponent(cc.EditBox).string),this.joining=!0,this.buttonText.getComponent(cc.Label).string="CANCEL",this.lobbyStatusText.active=!0,cc.sys.platform==cc.sys.WECHAT_GAME?this.ws.send({data:JSON.stringify(new n("player_name",[this.playerName,"wechat",this.playerId]))}):this.ws.send(JSON.stringify(new n("player_name",[this.playerName,"wechat",this.playerId])))},receiveMessage:function(e){var t=JSON.parse(e);switch(t.type){case"lobbyInfo":console.log(t.data),this.updateUsers(t.data);break;case"playerInfo":this.playerId=t.data,console.log(this.playerId);break;case"status":if("starting"==t.data[0])console.log("game is starting in "+t.data[1]),this.status="(starting in "+t.data[1]+")";else if("start"==t.data[0])switch(console.log("starting game"),cc.find("MANAGER").getComponent("aboutPlayer").playerId=this.playerId,cc.find("MANAGER").getComponent("aboutPlayer").room=t.data[1],cc.find("MANAGER").getComponent("aboutPlayer").serverIp=this.serverIp,cc.find("MANAGER").getComponent("aboutPlayer").crowns=this.crowns,this.leaveLobby(),t.data[2]){case 1:cc.director.loadScene("map1");break;case 2:cc.director.loadScene("map2");break;case 3:cc.director.loadScene("map3")}else"stop"==t.data[0]&&(this.status="(waiting for players...)");this.updateStatus()}},showLeaderboard:function(){this.leaderboardNode.active=!0},closeLeaderboard:function(){this.leaderboardNode.active=!1},closeLobby:function(){console.log("disconnected"),this.connected=!1,this.connecting=!1,this.joining=!1,this.buttonText.getComponent(cc.Label).string="PLAY",this.leaveLobby(),this.lobbyStatusText.active=!1},closeError:function(){this.errorNode.active=!1},joinLobby:function(){var e=this;this.connecting=!0,cc.sys.platform==cc.sys.WECHAT_GAME?(console.log("yes"),this.ws=wx.connectSocket({url:"ws://"+this.serverIp+":9091"}),this.ws.onOpen(function(){e.joinLobbySuccessfully()}),this.ws.onMessage(function(t){var n=t.data;e.receiveMessage(n)}),this.ws.onError(function(){console.log("couldn't connect"),e.errorNode.active=!0,e.connecting=!1}),this.ws.onClose(function(){e.closeLobby()})):(console.log("no"),this.ws=new WebSocket("ws://"+this.serverIp+":9091"),this.ws.addEventListener("open",function(){e.joinLobbySuccessfully()}),this.ws.addEventListener("message",function(t){var n=t.data;e.receiveMessage(n)}),this.ws.addEventListener("error",function(){console.log("couldn't connect"),e.errorNode.active=!0,e.connecting=!1}),this.ws.addEventListener("close",function(){e.closeLobby()}))},leaveLobby:function(){cc.sys.os==cc.sys.WECHAT_GAME?this.ws.closeSocket():this.ws.close()},updateUsers:function(){this.updateStatus()},updateStatus:function(){this.lobbyStatusText.getComponent(cc.Label).string=this.status},pressJoin:function(){this.refreshLeader(),this.haveUserData||cc.sys.platform!=cc.sys.WECHAT_GAME?this.joining||this.connecting?(this.joining=!1,this.buttonText.getComponent(cc.Label).string="PLAY",this.leaveLobby(),this.lobbyInfoText.active=!1,this.watch,this.lobbyStatusText.active=!1):this.joinLobby():this.createWeChatButton()},refreshLeader:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME)wx.request({url:"http://"+this.serverIp+":3000/",success:function(e){cc.find("Lobby Manager").getComponent("lobby").leaderboardNode.removeAllChildren();for(var t=e.data.data,n=0;n<t.length;n++){var i=cc.instantiate(cc.find("Lobby Manager").getComponent("lobby").playerStatPrefab);i.parent=cc.find("Lobby Manager").getComponent("lobby").leaderboardNode,i.getChildByName("PLACE").getComponent(cc.Label).string=n+1+".",i.getChildByName("NAME").getComponent(cc.Label).string=t[n].name,i.getChildByName("CROWNS").getComponent(cc.Label).string=t[n].crowns,t[n].id==cc.find("Lobby Manager").getComponent("lobby").playerId&&(cc.find("Canvas/CROWNS/num").getComponent(cc.Label).string=t[n].crowns,cc.find("Canvas/WINS").getComponent(cc.Label).string=t[n].wins+" wins",cc.find("Canvas/LOSES").getComponent(cc.Label).string=t[n].loses+" loses",cc.find("Lobby Manager").getComponent("lobby").crowns=t[n].crowns)}}}),console.log("refreshing");else{var e=new XMLHttpRequest;e.onreadystatechange=function(){cc.find("Lobby Manager").getComponent("lobby").leaderboardNode.removeAllChildren();var t=JSON.parse(e.responseText).data;console.log(t);for(var n=0;n<t.length;n++){var i=cc.instantiate(cc.find("Lobby Manager").getComponent("lobby").playerStatPrefab);i.parent=cc.find("Lobby Manager").getComponent("lobby").leaderboardNode,i.getChildByName("PLACE").getComponent(cc.Label).string=n+1+".",i.getChildByName("NAME").getComponent(cc.Label).string=t[n].name,i.getChildByName("CROWNS").getComponent(cc.Label).string=t[n].crowns,console.log(t[n].id),t[n].id==cc.find("Lobby Manager").getComponent("lobby").playerId&&(console.log("isplayer "+t[n].id),cc.find("Canvas/CROWNS/num").getComponent(cc.Label).string=t[n].crowns,cc.find("Canvas/WINS").getComponent(cc.Label).string=t[n].wins+" wins",cc.find("Canvas/LOSES").getComponent(cc.Label).string=t[n].loses+" loses",cc.find("Lobby Manager").getComponent("lobby").crowns=t[n].crowns)}},e.open("GET","http://"+this.serverIp+":3000/"),e.send()}this.refreshRecords()},refreshRecords:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME)wx.request({url:"http://"+this.serverIp+":3001/",success:function(e){cc.find("Lobby Manager").getComponent("lobby").recordsNode.removeAllChildren();for(var t=e.data.data,n=0;n<t.length;n++){var i=cc.instantiate(cc.find("Lobby Manager").getComponent("lobby").playerRecordPrefab);i.parent=cc.find("Lobby Manager").getComponent("lobby").recordsNode,i.getChildByName("PLACE").getComponent(cc.Label).string=n+1+".",i.getChildByName("NAME").getComponent(cc.Label).string=t[n].name,i.getChildByName("SPEED").getComponent(cc.Label).string=t[n].speed+" s"}}}),console.log("refreshing");else{var e=new XMLHttpRequest;e.onreadystatechange=function(){cc.find("Lobby Manager").getComponent("lobby").recordsNode.removeAllChildren();var t=JSON.parse(e.responseText).data;console.log(t);for(var n=0;n<t.length;n++){var i=cc.instantiate(cc.find("Lobby Manager").getComponent("lobby").playerRecordPrefab);i.parent=cc.find("Lobby Manager").getComponent("lobby").recordsNode,i.getChildByName("PLACE").getComponent(cc.Label).string=n+1+".",i.getChildByName("NAME").getComponent(cc.Label).string=t[n].name,i.getChildByName("SPEED").getComponent(cc.Label).string=t[n].speed+" s"}},e.open("GET","http://"+this.serverIp+":3001/"),e.send()}},openTutorial:function(){this.tutorialPage.active=!0,this.tutorials[0].active=!0},nextTutorial:function(){this.tutorials[this.tutorialIndex].active=!1,this.tutorialIndex+=1,this.tutorialIndex<this.tutorials.length?this.tutorials[this.tutorialIndex].active=!0:(this.tutorialPage.active=!1,this.tutorialIndex=0)},goToStory:function(){cc.director.loadScene("story")},createWeChatButton:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME){this.playerNameNode.active=!1,this.usernameNode.active=!0;var e=window.wx.getSystemInfoSync();e.screenWidth,e.screenHeight,wx.getSetting({success:function(e){if(console.log(e.authSetting),e.authSetting["scope.userInfo"])cc.find("Lobby Manager").getComponent("lobby").usernameNode.getComponent(cc.Label).string="1",wx.getUserInfo({success:function(e){var t=e.userInfo;cc.find("Lobby Manager").getComponent("lobby").usernameNode.getComponent(cc.Label).string=t.nickName,cc.find("Lobby Manager").getComponent("lobby").playerName=t.nickName,cc.find("Lobby Manager").getComponent("lobby").haveUserData=!0,wx.login({success:function(e){console.log("successful");var t="https://api.weixin.qq.com/sns/jscode2session?appid="+"wxa6602e501625471f"+"&secret="+"a0af4c896f22ce9c00d61a274e2afad1"+"&js_code="+e.code+"&grant_type=authorization_code";wx.request({url:t,data:{},method:"GET",success:function(e){console.log(e.data.openid),cc.find("Lobby Manager").getComponent("lobby").playerId=e.data.openid,cc.find("Lobby Manager").getComponent("lobby").refreshLeader()}})}})}});else{console.log("no");var t=wx.createUserInfoButton({type:"text",text:"allow miniprogram to use info?",style:{left:200,top:100,width:300,height:200,backgroundColor:"#FAEB3C",color:"#000000",fontSize:20,textAlign:"center",lineHeight:200}});t.onTap(function(e){if(e.userInfo){var n=e.userInfo;cc.find("Lobby Manager").getComponent("lobby").usernameNode.getComponent(cc.Label).string=n.nickName,t.destroy()}})}}})}},onLoad:function(){cc.sys.platform==cc.sys.WECHAT_GAME&&wx.getStorage({key:"played",success:function(){},fail:function(){cc.find("Lobby Manager").getComponent("lobby").openTutorial(),wx.setStorage({key:"played",data:"yes"})}}),this.createWeChatButton(),this.refreshLeader()},start:function(){}}),cc._RF.pop()},{}],movement:[function(e,t){"use strict";cc._RF.push(t,"caab8OJVKlDFIqDNLNx5rMw","movement"),cc.Class({extends:cc.Component,properties:{jumpHeight:0,smallJumpHeight:0,jumpDuration:0,moveSpeed:0,smallMoveSpeed:0,isPlayer:!1,clientScript:cc.Node,xSpeed:0,ySpeed:0,localCenter:0,grounder:cc.Node,body:cc.Node,animation:cc.Animation,deltaTime:0,fallMultiplier:2.5,growing:0,maxScale:1,minScale:.5,ateCake:!1,atePotion:!1,grounded:!1,movingRight:!1,movingLeft:!1,joystickMax:69,joystickVector:cc.v2(),joystickBall:cc.Node,emojis:cc.Node,timeStep:0,startTimer:!1,playingAnimation:!0,joystickMoving:!1,playedFalling:!1,soundController:cc.Node,sounds:null,busy:!1},disable:function(){if(cc.sys.platform==cc.sys.WECHAT_GAME){var e=cc.find("Canvas/UI/MOBILE/JOYSTICK"),t=cc.find("Canvas/UI/MOBILE/JUMP"),n=cc.find("Canvas/UI/MOBILE/POTION"),i=cc.find("Canvas/UI/MOBILE/CAKE");e.off(cc.Node.EventType.TOUCH_START,this.joystickStart,this),e.off(cc.Node.EventType.TOUCH_MOVE,this.joystickMove,this),e.off(cc.Node.EventType.TOUCH_END,this.joystickEnd,this),e.off(cc.Node.EventType.TOUCH_CANCEL,this.joystickEnd,this),t.off(cc.Node.EventType.TOUCH_START,this.jump,this),n.off(cc.Node.EventType.TOUCH_START,this.shrink,this),i.off(cc.Node.EventType.TOUCH_START,this.grow,this)}else cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this);this.node.getComponent(cc.RigidBody).gravityScale=0,this.node.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(0,0)},playEmoji:function(e){var t=this.emojis.getChildByName(e);t.active||(t.active=!0,cc.tween(t).to(.5,{position:cc.v2(this.node.x+Math.ceil(1e3*Math.random())*(Math.round(Math.random())?1:-1),this.node.y+2e3)},{easing:"sineOutIn"}).start(),cc.tween(t).delay(1).to(0,{position:cc.v2(this.node.getChildByName("body").getChildByName("head").x,this.node.getChildByName("body").getChildByName("head").y)}).call(function(){t.active=!1}).start())},onBeginContact:function(e,t,n){2!=t.tag||"environment"!=n.node.group&&"movingPlatform"!=n.node.group||(this.grounded=!0,this.moving?this.animation.play("walk"):(this.animation.play("land"),this.isPlayer&&this.sounds.landing.play(),this.scheduleOnce(function(){this.playingAnimation=!1},.3)),this.node.scaleY<this.maxScale?this.movingRight?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.smallMoveSpeed*this.deltaTime,this.ySpeed):this.movingLeft&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.smallMoveSpeed*this.deltaTime,this.ySpeed)):this.movingRight?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.moveSpeed*this.deltaTime,this.ySpeed):this.movingLeft&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.moveSpeed*this.deltaTime,this.ySpeed)))},onEndContact:function(e,t){2==t.tag&&(this.grounded=!1)},jumpRunAction:function(){var e=cc.tween().by(1,{y:300},{easing:"sineOut"}),t=cc.tween().by(1,{y:-300},{easing:"sineIn"});cc.tween(this.node).sequence(e,t).start()},moveRight:function(){this.movingLeft=!1,this.body.scaleX=-1,!this.moving&&this.grounded&&(this.animation.play("walk").wrapMode=cc.WrapMode.Loop,this.moving=!0),this.movingRight=!0,this.isPlayer&&(this.busy=!1,this.node.scaleY<this.maxScale?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.smallMoveSpeed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y):this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.moveSpeed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y),this.clientScript.getComponent("client").sendPlayerState("right"))},moveLeft:function(){this.movingRight=!1,this.body.scaleX=1,!this.moving&&this.grounded&&(this.animation.play("walk").wrapMode=cc.WrapMode.Loop,this.moving=!0),this.movingLeft=!0,this.isPlayer&&(this.node.scaleY<this.maxScale?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.smallMoveSpeed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y):this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.moveSpeed*this.deltaTime,this.getComponent(cc.RigidBody).linearVelocity.y),this.busy=!1,this.clientScript.getComponent("client").sendPlayerState("left"))},jump:function(){this.isPlayer?this.grounded&&(this.sounds.jump.play(),this.animation.play("jump"),this.grounded=!1,this.scheduleOnce(function(){this.node.scaleY>=this.maxScale?this.getComponent(cc.RigidBody).linearVelocity=cc.v2(this.getComponent(cc.RigidBody).linearVelocity.x,this.jumpHeight*this.deltaTime):this.getComponent(cc.RigidBody).linearVelocity=cc.v2(this.getComponent(cc.RigidBody).linearVelocity.x,this.smallJumpHeight*this.deltaTime),this.startTimer=!0,this.clientScript.getComponent("client").sendPlayerState("jump")},.1)):(this.animation.stop("walk"),this.animation.play("jump"),this.grounded=!1)},stopX:function(){this.animation.stop("walk"),this.busy=!1,this.moving&&(this.playingAnimation=!1),this.movingLeft=!1,this.movingRight=!1,this.moving=!1,this.isPlayer&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(0,this.ySpeed),this.clientScript.getComponent("client").sendPlayerState("stopX"))},stopY:function(){this.isPlayer&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.xSpeed,0),this.clientScript.getComponent("client").sendPlayerState("stopY"))},shrink:function(){this.isPlayer&&this.atePotion&&(this.sounds.drinking2.play(),this.growing=-1)},grow:function(){this.isPlayer&&this.ateCake&&(this.sounds.eating.play(),this.growing=1)},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.w:this.grounded&&this.jump();break;case cc.macro.KEY.a:this.moveLeft();break;case cc.macro.KEY.d:this.moveRight();break;case cc.macro.KEY.e:this.grow();break;case cc.macro.KEY.q:this.shrink()}},onKeyUp:function(e){e.keyCode,cc.macro.KEY.w,e.keyCode==cc.macro.KEY.a&&(this.movingLeft=!1),e.keyCode==cc.macro.KEY.d&&(this.movingRight=!1)},onLoad:function(){this.deltaTime=.016,this.body=this.node.getChildByName("body"),this.clientScript=cc.find("system"),this.sounds=new Map;for(var e=0;e<this.soundController.getComponents(cc.AudioSource).length;e++)this.sounds[this.soundController.getComponents(cc.AudioSource)[e].clip.name]=this.soundController.getComponents(cc.AudioSource)[e]},onDestroy:function(){cc.sys.platform==cc.sys.WECHAT_GAME||(cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this))},joystickStart:function(e){var t=e.getLocation(),n=cc.v2();cc.find("Canvas/mainCamera").getComponent(cc.Camera).getScreenToWorldPoint(t,n);var i=this.joystickBall.parent.convertToNodeSpaceAR(n);this.limitJoystick(i),this.setJoystickBallPos(i),this.joystickVector=i,this.joystickMovePlayer()},joystickMove:function(e){e.getTouches()[0];var t=e.getLocation(),n=cc.v2();cc.find("Canvas/mainCamera").getComponent(cc.Camera).getScreenToWorldPoint(t,n);var i=this.joystickBall.parent.convertToNodeSpaceAR(n);this.limitJoystick(i),this.setJoystickBallPos(i),this.joystickVector=i,this.joystickMovePlayer()},joystickMovePlayer:function(){this.joystickVector.x>0?this.moveRight():this.joystickVector.x<0&&this.moveLeft(),this.joystickMoving=!0},joystickEnd:function(){this.joystickMoving&&(this.movingLeft=!1,this.movingRight=!1,this.joystickMoving=!1),this.joystickVector=cc.Vec2.ZERO,this.setJoystickBallPos(cc.Vec2.ZERO)},setJoystickBallPos:function(e){this.joystickBall.setPosition(e)},limitJoystick:function(e){var t=e.mag();t>this.joystickMax&&e.mulSelf(this.joystickMax/t)},update:function(e){if(this.xSpeed=this.getComponent(cc.RigidBody).linearVelocity.x,this.ySpeed=this.getComponent(cc.RigidBody).linearVelocity.y,this.localCenter=this.getComponent(cc.RigidBody).getLocalCenter(),this.moving||!this.grounded||this.playingAnimation||(this.animation.play("stand"),this.playingAnimation=!0),Math.abs(e-this.deltaTime)<.05&&(this.deltaTime=e),this.clientScript.getComponent("client").gameStarted)if(0==this.clientScript.getComponent("client").playerId);else if(this.clientScript.getComponent("client").playerId==this.node.name&&!this.isPlayer)if(this.isPlayer=!0,this.getComponent(cc.RigidBody),cc.sys.platform==cc.sys.WECHAT_GAME){cc.find("Canvas/UI/MOBILE").active=!0,this.joystickBall=cc.find("Canvas/UI/MOBILE/JOYSTICK/BALL");var t=cc.find("Canvas/UI/MOBILE/JOYSTICK"),n=cc.find("Canvas/UI/MOBILE/JUMP"),i=cc.find("Canvas/UI/MOBILE/POTION"),o=cc.find("Canvas/UI/MOBILE/CAKE");t.on(cc.Node.EventType.TOUCH_START,this.joystickStart,this),t.on(cc.Node.EventType.TOUCH_MOVE,this.joystickMove,this),t.on(cc.Node.EventType.TOUCH_END,this.joystickEnd,this),t.on(cc.Node.EventType.TOUCH_CANCEL,this.joystickEnd,this),n.on(cc.Node.EventType.TOUCH_START,this.jump,this),i.on(cc.Node.EventType.TOUCH_START,this.shrink,this),o.on(cc.Node.EventType.TOUCH_START,this.grow,this)}else{this.joystickBall=cc.find("Canvas/UI/MOBILE/JOYSTICK/BALL");var s=cc.find("Canvas/UI/MOBILE/JOYSTICK"),c=cc.find("Canvas/UI/MOBILE/JUMP"),a=cc.find("Canvas/UI/MOBILE/POTION"),r=cc.find("Canvas/UI/MOBILE/CAKE");s.on(cc.Node.EventType.TOUCH_START,this.joystickStart,this),s.on(cc.Node.EventType.TOUCH_MOVE,this.joystickMove,this),s.on(cc.Node.EventType.TOUCH_END,this.joystickEnd,this),s.on(cc.Node.EventType.TOUCH_CANCEL,this.joystickEnd,this),c.on(cc.Node.EventType.TOUCH_START,this.jump,this),a.on(cc.Node.EventType.TOUCH_START,this.shrink,this),r.on(cc.Node.EventType.TOUCH_START,this.grow,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this)}this.isPlayer&&((this.grounded&&!cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer>2||cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer<2)&&(cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer>2?cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer-=200*e:cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer<2&&(cc.find("Canvas/mainCamera").getComponent("cameraFollow").yOffsetPlayer+=200*e)),cc.find("Canvas/mainCamera").getComponent("cameraFollow").xOffsetPlayer<50&&this.movingRight&&(cc.find("Canvas/mainCamera").getComponent("cameraFollow").xOffsetPlayer+=200*e),cc.find("Canvas/mainCamera").getComponent("cameraFollow").xOffsetPlayer>-50&&this.movingLeft&&(cc.find("Canvas/mainCamera").getComponent("cameraFollow").xOffsetPlayer-=200*e),cc.director.getPhysicsManager().gravity=cc.v2(0,1e3*-this.deltaTime),this.node.getComponent(cc.RigidBody).gravityScale=3e3*this.deltaTime,this.movingRight||this.movingLeft||this.stopX(),1==this.growing?this.maxScale>this.node.scaleY?(this.node.scaleX+=.05*e,this.node.scaleY+=.05*e):(this.growing=0,this.grounded&&(this.movingRight?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.moveSpeed*this.deltaTime,this.ySpeed):this.movingLeft&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.moveSpeed*this.deltaTime,this.ySpeed)))):-1==this.growing&&(this.minScale<this.node.scaleY?(this.node.scaleX-=.05*e,this.node.scaleY-=.05*e):(this.growing=0,this.grounded&&(this.movingRight?this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(this.smallMoveSpeed*this.deltaTime,this.ySpeed):this.movingLeft&&(this.getComponent(cc.RigidBody).linearVelocity=cc.Vec2(-this.smallMoveSpeed*this.deltaTime,this.ySpeed))))))}}),cc._RF.pop()},{}],movingPlatform:[function(e,t){"use strict";var n;cc._RF.push(t,"d755evL6ydJUpa+onXmnJAb","movingPlatform"),cc.Class({extends:cc.Component,properties:(n={movingPlayer:cc.Node,rb:cc.RigidBody,speed:5e5,startPos:0,distance:1e3,direction:1,players:cc.Node,spinning:!1,sideToSide:!1,dropping:!1,spinSpeed:1,playersOnMe:0,maxPlayers:1,falling:!1,rising:!1,upDown:!1,moveUpTime:3},n.startPos=cc.v2(),n),onLoad:function(){this.rb=this.node.getComponent(cc.RigidBody),this.startPos=this.node.x,this.startPos=cc.v2(this.node.x,this.node.y)},start:function(){},shake:function(){this.falling=!0,this.scheduleOnce(function(){this.falling=!1},.1),this.scheduleOnce(function(){this.rising=!0},.2),this.scheduleOnce(function(){this.rising=!1},.3)},onBeginContact:function(e,t,n){"player"==n.node.group&&(!this.dropping||this.falling||this.rising||this.shake(),this.playersOnMe+=1,n.node.getComponent("movement").isPlayer&&(this.movingPlayer=n.node)),"dangerous"==n.node.group&&this.dropping&&(this.node.x=this.startPos.x,this.node.y=this.startPos.y)},onCollisionEnter:function(e){"dangerous"==e.node.group&&this.dropping&&(this.node.x=this.startPos.x,this.node.y=this.startPos.y,this.falling=!1,this.rising=!1)},onEndContact:function(e,t,n){n.node.x,this.node.x,"player"==n.node.group&&(this.playersOnMe-=1),n.node==this.movingPlayer&&(this.movingPlayer=null)},moveUpDown:function(){this.falling?(this.falling=!1,this.rising=!0):this.rising?(this.falling=!0,this.rising=!1):this.falling=!0},update:function(e){cc.find("system").getComponent("client").gameStarted&&(this.sideToSide?(Math.abs(this.startPos-this.node.x)>=this.distance&&(this.direction*=-1),this.rb.linearVelocity=cc.v2(this.speed*e*this.direction,0)):this.spinning?this.node.angle+=e*this.spinSpeed:this.dropping&&this.playersOnMe>this.maxPlayers&&(this.falling=!0),this.falling&&(this.node.y-=this.speed*e),this.rising&&(this.node.y+=this.speed*e),this.upDown&&(this.schedule(this.moveUpDown,this.moveUpTime),this.upDown=!1))}}),cc._RF.pop()},{}],start:[function(e,t){"use strict";cc._RF.push(t,"9c385fHokpDq6x4arEvSZ2D","start"),cc.Class({extends:cc.Component,properties:{background:cc.Node,playedBefore:!1},onLoad:function(){cc.sys.platform==cc.sys.WECHAT_GAME?wx.getStorage({key:"played",success:function(){cc.find("Canvas/title").getComponent("start").playedBefore=!0},fail:function(){console.log("not played before")}}):this.playedBefore=!1,cc.tween(this.node).to(2,{scaleX:1,scaleY:1},{easing:"sineOut"}).start(),this.scheduleOnce(function(){this.node.color=cc.Color.BLACK,this.background.color=cc.Color.YELLOW},3),this.scheduleOnce(function(){this.playedBefore?cc.director.loadScene("home"):cc.director.loadScene("story")},5)}}),cc._RF.pop()},{}],storyManager:[function(e,t){"use strict";cc._RF.push(t,"56304dpblJDHYvlEvlTj4bj","storyManager"),cc.Class({extends:cc.Component,properties:{panel1:cc.Node,panel2:cc.Node,panel3:cc.Node,panel4:cc.Node,panel5:cc.Node,shake:cc.Node,rabbit:cc.Node,text:cc.Label,textArea:cc.Node,showTextSpeed:.1,speech1:"Alice, welcome back to Wonderland!",speech2:" However, I must tell you that this world is no longer the same as before. ",speech3:"Things have changed and now you aren't the only Alice. In fact, there are tons of Alices. ",speech4:"The Red Queen is forcing them to compete against each other in a race.If you reach the end, you will gain crowns.Lose and you might lose crowns.",speech5:"If you win enough crowns, you may be able to escape Wonderland.",speech6:"I wish you the best of luck.",theChar:"a",textIndex:0,theTextA:"",coolNode:cc.Node,thanks:cc.Node},showChar:function(){this.text.string+=this.theChar},revealText:function(e){this.text.string="",this.textIndex=0,this.theTextA=e;for(var t=0;t<e.length;t++)this.scheduleOnce(function(){this.textIndex<this.theTextA.length&&(this.text.string+=this.theTextA[this.textIndex],this.textIndex+=1)},this.showTextSpeed*t)},onLoad:function(){console.log(this.speech1[0]),this.panel1.opacity=0,this.panel2.opacity=0,this.panel3.opacity=0,this.panel4.opacity=0,this.panel5.opacity=0,this.rabbit.opacity=0,this.textArea.opacity=0,this.coolNode.opacity=0,this.shake.opacity=0,cc.tween(this.panel1).to(2,{opacity:255},{easing:"sineOut"}).start(),this.scheduleOnce(function(){cc.tween(this.panel2).to(2,{opacity:255},{easing:"sineOut"}).start()},3),this.scheduleOnce(function(){cc.tween(this.panel3).to(2,{opacity:255},{easing:"sineOut"}).start()},6),this.scheduleOnce(function(){this.panel1.active=!1,this.panel2.active=!1,this.panel3.active=!1,cc.tween(this.panel4).to(2,{opacity:255},{easing:"sineOut"}).start()},14),this.scheduleOnce(function(){cc.tween(this.panel5).to(2,{opacity:255},{easing:"sineOut"}).start(),cc.tween(this.shake).to(2,{opacity:255},{easing:"sineOut"}).start()},18),this.scheduleOnce(function(){this.panel4.active=!1,this.panel5.active=!1,this.shake.active=!1,cc.tween(this.rabbit).to(2,{opacity:255},{easing:"sineOut"}).start(),cc.tween(this.textArea).to(2,{opacity:255},{easing:"sineOut"}).start()},26),this.scheduleOnce(function(){this.revealText(this.speech1),this.scheduleOnce(function(){this.revealText(this.speech2),this.scheduleOnce(function(){this.revealText(this.speech3),this.scheduleOnce(function(){this.revealText(this.speech4),this.scheduleOnce(function(){this.revealText(this.speech5),this.scheduleOnce(function(){this.revealText(this.speech6),this.scheduleOnce(function(){cc.tween(this.coolNode).to(2,{opacity:255},{easing:"sineOut"}).start(),this.scheduleOnce(function(){cc.tween(this.thanks).to(2,{scaleX:.9,scaleY:.9},{easing:"sineOut"}).start(),this.scheduleOnce(function(){cc.director.loadScene("home")},3)},2)},7)},8)},14)},8)},8)},6)},27)}}),cc._RF.pop()},{}]},{},["aboutPlayer","cameraFollow","client","enableGravity","enemyScript","gameManager","groundChecker","hitChecker","item","lobby","movement","movingPlatform","start","storyManager"]);