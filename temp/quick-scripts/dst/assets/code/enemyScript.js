
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/code/enemyScript.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '64fd02CYvtGPYd3Jt9F1sLL', 'enemyScript');
// code/enemyScript.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    chasingPlayer: cc.Node,
    speed: 100,
    player: cc.Node,
    walkSpeed: 50,
    jumpHeight: 100,
    checking: false,
    deltaTime: 0,
    grounded: false,
    alertNode: cc.Node,
    patrolling: false,
    animation: cc.Animation,
    canAttack: true,
    attackCooldown: 2,
    attackRange: 5,
    canMove: true,
    moving: false,
    playingIdle: true
  },
  chasePlayer: function chasePlayer(player) {
    this.chasingPlayer = player;

    if (player == this.player) {
      this.alertNode.active = true;
      cc.find("system").getComponent("client").sendEnemyState("chaseNew", [null, null], this.node.name);
    } else {
      this.alertNode.active = false;
    }
  },
  jump: function jump() {
    if (this.chasingPlayer == this.player) {
      cc.find("system").getComponent("client").sendEnemyState("jump", [null, null], this.node.name);
      this.getComponent(cc.RigidBody).linearVelocity = cc.Vec2(this.getComponent(cc.RigidBody).linearVelocity.x, this.jumpHeight);
    }
  },
  attack: function attack() {
    this.canAttack = false;
    this.animation.play("cardGuyAttack");
    this.scheduleOnce(function () {
      this.canAttack = true;
    }, this.attackCooldown);
  },
  moveRight: function moveRight() {
    //play animation only once
    if (!this.moving) {
      var animState = this.animation.play("cardGuyWalk");
      animState.wrapMode = cc.WrapMode.Loop;
      this.moving = true;
      this.playingIdle = false;
    }

    this.node.scaleX = -Math.abs(this.node.scaleX);

    if (this.chasingPlayer == this.player) {
      cc.find("system").getComponent("client").sendEnemyState("right", [null, null], this.node.name);
      this.getComponent(cc.RigidBody).linearVelocity = cc.Vec2(this.speed * this.deltaTime, this.getComponent(cc.RigidBody).linearVelocity.y);
    }
  },
  moveLeft: function moveLeft() {
    if (!this.moving) {
      var animState = this.animation.play("cardGuyWalk");
      animState.wrapMode = cc.WrapMode.Loop;
      this.moving = true;
      this.playingIdle = false;
    }

    this.node.scaleX = Math.abs(this.node.scaleX);

    if (this.chasingPlayer == this.player) {
      cc.find("system").getComponent("client").sendEnemyState("left", [null, null], this.node.name);
      this.getComponent(cc.RigidBody).linearVelocity = cc.Vec2(-this.speed * this.deltaTime, this.getComponent(cc.RigidBody).linearVelocity.y);
    }
  },
  onCollisionEnter: function onCollisionEnter(other, self) {
    //console.log(other.node.name);
    if (other.node.group == "playerHitbox") {
      //if not chasing this player, chase him
      if (other.node.getParent().getParent() == this.player) {
        if (this.chasingPlayer != null) {
          this.checking = true;
        } else {
          this.chasePlayer(this.player);
        }
      }
    }
  },
  onCollisionExit: function onCollisionExit(other, self) {
    if (other.node.getParent().getParent() == this.chasingPlayer) {
      this.chasingPlayer = null;
      this.getComponent(cc.RigidBody).linearVelocity = cc.Vec2(0, 0);
      this.alertNode.active = false;
    }

    if (other.node.getParent().getParent() == this.player) {
      this.checking = false;
    }
  },
  onBeginContact: function onBeginContact(contact, self, other) {
    if (self.tag == 2) {
      this.grounded = true;
    }
  },
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {},
  update: function update(dt) {
    this.deltaTime = dt;

    if (this.canMove) {
      //play idle animation not moving
      if (this.getComponent(cc.RigidBody).linearVelocity.x == 0 && !this.playingIdle) {
        this.animation.stop("cardGuyWalk");
        this.animation.play("idle");
        this.moving = false;
        this.playingIdle = true;
      }

      if (this.player == null) {
        if (cc.find("system").getComponent("client").playerId == 0) {//do nothing
        } else {
          this.player = cc.find("Canvas/Players/" + cc.find("system").getComponent("client").playerId);
        }
      } else {
        if (this.chasingPlayer == this.player) {
          cc.find("system").getComponent("client").sendEnemyState("position", [this.node.x, this.node.y], this.node.name);
          var direction = (this.player.x - this.node.x) / Math.abs(this.player.x - this.node.x);
          if (direction > 0) this.moveRight();else this.moveLeft();

          if (Math.sqrt(Math.pow(this.player.x - this.node.x, 2) + Math.pow(this.player.y - this.node.y, 2)) < this.attackRange) {
            if (this.canAttack) {
              this.attack();
            }
          } //jump if if player is above
          //if (this.player.y > (this.node.y + 100)) {
          //    if (this.grounded)
          //        this.jump();
          //}

        } else if (this.checking && this.chasingPlayer != null) {
          var distance = Math.abs(this.node.x - this.player.x);
          var distance2 = Math.abs(this.node.x - this.chasingPlayer.x);
          if (this.player != this.chasingPlayer && distance < distance2) this.chasePlayer(this.player);
        }
      }
    } else {
      if (this.canAttack) {
        this.attack();
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcY29kZVxcZW5lbXlTY3JpcHQuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJjaGFzaW5nUGxheWVyIiwiTm9kZSIsInNwZWVkIiwicGxheWVyIiwid2Fsa1NwZWVkIiwianVtcEhlaWdodCIsImNoZWNraW5nIiwiZGVsdGFUaW1lIiwiZ3JvdW5kZWQiLCJhbGVydE5vZGUiLCJwYXRyb2xsaW5nIiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiY2FuQXR0YWNrIiwiYXR0YWNrQ29vbGRvd24iLCJhdHRhY2tSYW5nZSIsImNhbk1vdmUiLCJtb3ZpbmciLCJwbGF5aW5nSWRsZSIsImNoYXNlUGxheWVyIiwiYWN0aXZlIiwiZmluZCIsImdldENvbXBvbmVudCIsInNlbmRFbmVteVN0YXRlIiwibm9kZSIsIm5hbWUiLCJqdW1wIiwiUmlnaWRCb2R5IiwibGluZWFyVmVsb2NpdHkiLCJWZWMyIiwieCIsImF0dGFjayIsInBsYXkiLCJzY2hlZHVsZU9uY2UiLCJtb3ZlUmlnaHQiLCJhbmltU3RhdGUiLCJ3cmFwTW9kZSIsIldyYXBNb2RlIiwiTG9vcCIsInNjYWxlWCIsIk1hdGgiLCJhYnMiLCJ5IiwibW92ZUxlZnQiLCJvbkNvbGxpc2lvbkVudGVyIiwib3RoZXIiLCJzZWxmIiwiZ3JvdXAiLCJnZXRQYXJlbnQiLCJvbkNvbGxpc2lvbkV4aXQiLCJvbkJlZ2luQ29udGFjdCIsImNvbnRhY3QiLCJ0YWciLCJzdGFydCIsInVwZGF0ZSIsImR0Iiwic3RvcCIsInBsYXllcklkIiwiZGlyZWN0aW9uIiwic3FydCIsImRpc3RhbmNlIiwiZGlzdGFuY2UyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUNBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsYUFBYSxFQUFFSixFQUFFLENBQUNLLElB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UUFBTCxJQUFpQixLQUFLTixhQUFMLElBQXNCLElBQTNDLEVBQWlEO0FBQ2xELGNBQUk0RCxRQUFRLEdBQUdwQixJQUFJLENBQUNDLEdBQUwsQ0FBUyxLQUFLakIsSUFBTCxDQUFVTSxDQUFWLEdBQWMsS0FBSzNCLE1BQUwsQ0FBWTJCLENBQW5DLENBQWY7QUFDQSxjQUFJK0IsU0FBUyxHQUFHckIsSUFBSSxDQUFDQyxHQUFMLENBQVMsS0FBS2pCLElBQUwsQ0FBVU0sQ0FBVixHQUFjLEtBQUs5QixhQUFMLENBQW1COEIsQ0FBMUMsQ0FBaEI7QUFDQSxjQUFJLEtBQUszQixNQUFMLElBQWUsS0FBS0gsYUFBcEIsSUFBcUM0RCxRQUFRLEdBQUdDLFNBQXBELEVBQ0ksS0FBSzFDLFdBQUwsQ0FBaUIsS0FBS2hCLE1BQXRCO0FBQ1A7QUFFSjtBQUNKLEtBOUNELE1BK0NLO0FBQ0QsVUFBSSxLQUFLVSxTQUFULEVBQW9CO0FBQ2hCLGFBQUtrQixNQUFMO0FBQ0g7QUFDSjtBQUdKO0FBL0tJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGNoYXNpbmdQbGF5ZXI6IGNjLk5vZGUsXHJcbiAgICAgICAgc3BlZWQ6IDEwMCxcclxuICAgICAgICBwbGF5ZXI6IGNjLk5vZGUsXHJcbiAgICAgICAgd2Fsa1NwZWVkOiA1MCxcclxuICAgICAgICBqdW1wSGVpZ2h0OiAxMDAsXHJcbiAgICAgICAgY2hlY2tpbmc6IGZhbHNlLFxyXG4gICAgICAgIGRlbHRhVGltZTogMCxcclxuICAgICAgICBncm91bmRlZDogZmFsc2UsXHJcbiAgICAgICAgYWxlcnROb2RlOiBjYy5Ob2RlLFxyXG4gICAgICAgIHBhdHJvbGxpbmc6IGZhbHNlLFxyXG4gICAgICAgIGFuaW1hdGlvbjogY2MuQW5pbWF0aW9uLFxyXG4gICAgICAgIGNhbkF0dGFjazogdHJ1ZSxcclxuICAgICAgICBhdHRhY2tDb29sZG93bjogMixcclxuICAgICAgICBhdHRhY2tSYW5nZTogNSxcclxuICAgICAgICBjYW5Nb3ZlOiB0cnVlLFxyXG4gICAgICAgIG1vdmluZzogZmFsc2UsXHJcbiAgICAgICAgcGxheWluZ0lkbGU6IHRydWUsXHJcbiAgICB9LFxyXG5cclxuICAgIGNoYXNlUGxheWVyKHBsYXllcikge1xyXG4gICAgICAgIHRoaXMuY2hhc2luZ1BsYXllciA9IHBsYXllcjtcclxuICAgICAgICBpZiAocGxheWVyID09IHRoaXMucGxheWVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWxlcnROb2RlLmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBjYy5maW5kKFwic3lzdGVtXCIpLmdldENvbXBvbmVudChcImNsaWVudFwiKS5zZW5kRW5lbXlTdGF0ZShcImNoYXNlTmV3XCIsIFtudWxsLG51bGxdLCB0aGlzLm5vZGUubmFtZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hbGVydE5vZGUuYWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIGp1bXAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hhc2luZ1BsYXllciA9PSB0aGlzLnBsYXllcikge1xyXG4gICAgICAgICAgICBjYy5maW5kKFwic3lzdGVtXCIpLmdldENvbXBvbmVudChcImNsaWVudFwiKS5zZW5kRW5lbXlTdGF0ZShcImp1bXBcIiwgW251bGwsIG51bGxdLCB0aGlzLm5vZGUubmFtZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkgPSBjYy5WZWMyKHRoaXMuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkueCwgdGhpcy5qdW1wSGVpZ2h0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG4gICAgfSxcclxuICAgIGF0dGFjaygpIHtcclxuICAgICAgICB0aGlzLmNhbkF0dGFjayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0aW9uLnBsYXkoXCJjYXJkR3V5QXR0YWNrXCIpO1xyXG4gICAgICAgIHRoaXMuc2NoZWR1bGVPbmNlKGZ1bmN0aW9uICgpIHsgdGhpcy5jYW5BdHRhY2sgPSB0cnVlOyB9LCB0aGlzLmF0dGFja0Nvb2xkb3duKTtcclxuICAgIH0sXHJcbiAgICBtb3ZlUmlnaHQoKSB7XHJcbiAgICAgICAgLy9wbGF5IGFuaW1hdGlvbiBvbmx5IG9uY2VcclxuICAgICAgICBpZiAoIXRoaXMubW92aW5nKSB7XHJcbiAgICAgICAgICAgIGxldCBhbmltU3RhdGUgPSB0aGlzLmFuaW1hdGlvbi5wbGF5KFwiY2FyZEd1eVdhbGtcIik7XHJcbiAgICAgICAgICAgIGFuaW1TdGF0ZS53cmFwTW9kZSA9IGNjLldyYXBNb2RlLkxvb3A7XHJcbiAgICAgICAgICAgIHRoaXMubW92aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5wbGF5aW5nSWRsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLm5vZGUuc2NhbGVYID0gLU1hdGguYWJzKHRoaXMubm9kZS5zY2FsZVgpO1xyXG4gICAgICAgIGlmICh0aGlzLmNoYXNpbmdQbGF5ZXIgPT0gdGhpcy5wbGF5ZXIpIHtcclxuICAgICAgICAgICAgY2MuZmluZChcInN5c3RlbVwiKS5nZXRDb21wb25lbnQoXCJjbGllbnRcIikuc2VuZEVuZW15U3RhdGUoXCJyaWdodFwiLCBbbnVsbCwgbnVsbF0sIHRoaXMubm9kZS5uYW1lKTtcclxuICAgICAgICAgICAgdGhpcy5nZXRDb21wb25lbnQoY2MuUmlnaWRCb2R5KS5saW5lYXJWZWxvY2l0eSA9IGNjLlZlYzIodGhpcy5zcGVlZCAqIHRoaXMuZGVsdGFUaW1lLCB0aGlzLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpLmxpbmVhclZlbG9jaXR5LnkpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBtb3ZlTGVmdCgpIHtcclxuICAgICAgICBpZiAoIXRoaXMubW92aW5nKSB7XHJcbiAgICAgICAgICAgIGxldCBhbmltU3RhdGUgPSB0aGlzLmFuaW1hdGlvbi5wbGF5KFwiY2FyZEd1eVdhbGtcIik7XHJcbiAgICAgICAgICAgIGFuaW1TdGF0ZS53cmFwTW9kZSA9IGNjLldyYXBNb2RlLkxvb3A7XHJcbiAgICAgICAgICAgIHRoaXMubW92aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5wbGF5aW5nSWRsZSA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICB0aGlzLm5vZGUuc2NhbGVYID0gTWF0aC5hYnModGhpcy5ub2RlLnNjYWxlWCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hhc2luZ1BsYXllciA9PSB0aGlzLnBsYXllcikge1xyXG4gICAgICAgICAgICBjYy5maW5kKFwic3lzdGVtXCIpLmdldENvbXBvbmVudChcImNsaWVudFwiKS5zZW5kRW5lbXlTdGF0ZShcImxlZnRcIiwgW251bGwsIG51bGxdLCB0aGlzLm5vZGUubmFtZSk7XHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkgPSBjYy5WZWMyKC10aGlzLnNwZWVkICogdGhpcy5kZWx0YVRpbWUsIHRoaXMuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkueSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH0sXHJcbiAgICBvbkNvbGxpc2lvbkVudGVyOiBmdW5jdGlvbiAob3RoZXIsIHNlbGYpIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKG90aGVyLm5vZGUubmFtZSk7XHJcbiAgICAgICAgaWYgKG90aGVyLm5vZGUuZ3JvdXAgPT0gXCJwbGF5ZXJIaXRib3hcIikge1xyXG4gICAgICAgICAgICAvL2lmIG5vdCBjaGFzaW5nIHRoaXMgcGxheWVyLCBjaGFzZSBoaW1cclxuICAgICAgICAgICAgaWYgKG90aGVyLm5vZGUuZ2V0UGFyZW50KCkuZ2V0UGFyZW50KCkgPT0gdGhpcy5wbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNpbmdQbGF5ZXIgIT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hlY2tpbmcgPSB0cnVlOyAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlUGxheWVyKHRoaXMucGxheWVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcblxyXG4gICAgb25Db2xsaXNpb25FeGl0OiBmdW5jdGlvbiAob3RoZXIsIHNlbGYpIHtcclxuICAgICAgICBpZiAob3RoZXIubm9kZS5nZXRQYXJlbnQoKS5nZXRQYXJlbnQoKSA9PSB0aGlzLmNoYXNpbmdQbGF5ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGFzaW5nUGxheWVyID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHRoaXMuZ2V0Q29tcG9uZW50KGNjLlJpZ2lkQm9keSkubGluZWFyVmVsb2NpdHkgPSBjYy5WZWMyKDAsIDApO1xyXG4gICAgICAgICAgICB0aGlzLmFsZXJ0Tm9kZS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG90aGVyLm5vZGUuZ2V0UGFyZW50KCkuZ2V0UGFyZW50KCkgPT0gdGhpcy5wbGF5ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jaGVja2luZyA9IGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcblxyXG5cclxuICAgIG9uQmVnaW5Db250YWN0KGNvbnRhY3QsIHNlbGYsIG90aGVyKSB7XHJcbiAgICAgICAgaWYgKHNlbGYudGFnID09IDIpIHtcclxuICAgICAgICAgICAgdGhpcy5ncm91bmRlZCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxyXG5cclxuICAgIC8vIG9uTG9hZCAoKSB7fSxcclxuXHJcbiAgICBzdGFydCgpIHtcclxuICAgIH0sXHJcblxyXG4gICAgdXBkYXRlKGR0KSB7XHJcbiAgICAgICAgdGhpcy5kZWx0YVRpbWUgPSBkdDtcclxuICAgICAgICBcclxuICAgICAgICBcclxuICAgICAgICBpZiAodGhpcy5jYW5Nb3ZlKSB7XHJcbiAgICAgICAgICAgIC8vcGxheSBpZGxlIGFuaW1hdGlvbiBub3QgbW92aW5nXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdldENvbXBvbmVudChjYy5SaWdpZEJvZHkpLmxpbmVhclZlbG9jaXR5LnggPT0gMCAmJiAhdGhpcy5wbGF5aW5nSWRsZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb24uc3RvcChcImNhcmRHdXlXYWxrXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hbmltYXRpb24ucGxheShcImlkbGVcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm1vdmluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5aW5nSWRsZSA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBsYXllciA9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2MuZmluZChcInN5c3RlbVwiKS5nZXRDb21wb25lbnQoXCJjbGllbnRcIikucGxheWVySWQgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vZG8gbm90aGluZ1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllciA9IGNjLmZpbmQoXCJDYW52YXMvUGxheWVycy9cIiArIGNjLmZpbmQoXCJzeXN0ZW1cIikuZ2V0Q29tcG9uZW50KFwiY2xpZW50XCIpLnBsYXllcklkKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYXNpbmdQbGF5ZXIgPT0gdGhpcy5wbGF5ZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjYy5maW5kKFwic3lzdGVtXCIpLmdldENvbXBvbmVudChcImNsaWVudFwiKS5zZW5kRW5lbXlTdGF0ZShcInBvc2l0aW9uXCIsIFt0aGlzLm5vZGUueCwgdGhpcy5ub2RlLnldLCB0aGlzLm5vZGUubmFtZSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkaXJlY3Rpb24gPSAodGhpcy5wbGF5ZXIueCAtIHRoaXMubm9kZS54KSAvIE1hdGguYWJzKHRoaXMucGxheWVyLnggLSB0aGlzLm5vZGUueCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA+IDApXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZVJpZ2h0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm1vdmVMZWZ0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChNYXRoLnNxcnQoKHRoaXMucGxheWVyLnggLSB0aGlzLm5vZGUueCkgKiogMiArICh0aGlzLnBsYXllci55IC0gdGhpcy5ub2RlLnkpICoqIDIpIDwgdGhpcy5hdHRhY2tSYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jYW5BdHRhY2spIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYXR0YWNrKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgLy9qdW1wIGlmIGlmIHBsYXllciBpcyBhYm92ZVxyXG4gICAgICAgICAgICAgICAgICAgIC8vaWYgKHRoaXMucGxheWVyLnkgPiAodGhpcy5ub2RlLnkgKyAxMDApKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgaWYgKHRoaXMuZ3JvdW5kZWQpXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHRoaXMuanVtcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vfVxyXG5cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuY2hlY2tpbmcgJiYgdGhpcy5jaGFzaW5nUGxheWVyICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGlzdGFuY2UgPSBNYXRoLmFicyh0aGlzLm5vZGUueCAtIHRoaXMucGxheWVyLngpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBkaXN0YW5jZTIgPSBNYXRoLmFicyh0aGlzLm5vZGUueCAtIHRoaXMuY2hhc2luZ1BsYXllci54KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5wbGF5ZXIgIT0gdGhpcy5jaGFzaW5nUGxheWVyICYmIGRpc3RhbmNlIDwgZGlzdGFuY2UyKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXNlUGxheWVyKHRoaXMucGxheWVyKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNhbkF0dGFjaykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5hdHRhY2soKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgXHJcbiAgICB9LFxyXG59KTtcclxuIl19